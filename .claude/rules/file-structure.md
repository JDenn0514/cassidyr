# Package File Structure

## R/ Directory Organization

cassidyr/
├── R/
│   ├── api-core.R                      ✓ Complete (API layer)
│   ├── cassidy-classes.R               ✓ Complete (S3 print methods)
│   ├── cassidyr-package.R              ✓ Complete (package docs)
│   │
│   ├── chat-core.R                     ✓ Complete (chat interface)
│   ├── chat-ui.R                       ✓ Complete (Shiny app main)
│   ├── chat-ui-components.R            ✓ Complete (UI components)
│   ├── chat-conversation.R             ✓ Complete (S7 ConversationManager)
│   ├── chat-persistence.R              ✓ Complete (Save/load conversations)
│   ├── chat-context-gather.R           ✓ Complete (Context gathering logic)
│   ├── chat-helpers.R                  ✓ Complete (Write code/files)
│   ├── chat-utils.R                    ✓ Complete (File tree, data frame utils)
│   ├── chat-css.R                      ✓ Complete (App styling + copy code button)
│   ├── chat-js.R                       ✓ Complete (App JavaScript + copy code button)
│   │
│   ├── chat-handlers-message.R         ✓ Complete (Message handling)
│   ├── chat-handlers-conversation.R    ✓ Complete (Conversation management)
│   ├── chat-handlers-context-apply.R   ✓ Complete (Apply context to messages)
│   ├── chat-handlers-context-data.R    ✓ Complete (Data frame context handlers)
│   ├── chat-handlers-context-files.R   ✓ Complete (File context handlers)
│   │
│   ├── context-project.R               ✓ Complete (project context)
│   ├── context-data.R                  ✓ Complete (data frame context)
│   ├── context-env.R                   ✓ Complete (environment context)
│   ├── context-file.R                  ✓ Complete (file context)
│   ├── context-file-parse.R            ✓ Complete (R file parsing for context)
│   ├── context-combine.R               ✓ Complete (combine contexts)
│   ├── context-config.R                ✓ Complete (read CASSIDY.md files)
│   ├── context-git.R                   ✓ Complete (Git status context)
│   ├── context-tools.R                 ✓ Complete (internal helpers)
│   │
│   ├── skills-discovery.R              ✓ Complete (Skill discovery & loading)
│   ├── skills-context.R                ✓ Complete (Context integration)
│   ├── skills-functions.R              ✓ Complete (User functions)
│   │
│   ├── scripts.R                       ✓ Complete (script-to-quarto, commenting)
│   ├── utils.R                         ✓ Complete (%||% operator)
│   └── xyz.R                           ✓ Complete (dev helpers - update imports)
│
├── tests/
│   ├── testthat/
│   │   ├── test-api-core.R           ✓ Complete
│   │   ├── test-chat-core.R          ✓ Complete
│   │   ├── test-context-project.R    ✓ Complete
│   │   ├── test-context-data.R       ✓ Complete
│   │   ├── test-context-environment.R ✓ Complete
│   │   ├── test-context-tools.R      ✓ Complete
│   │   └── test-skills.R             ✓ Complete
│   └── manual/
│       ├── test-api-live.R
│       ├── test-chat-live.R
│       └── test-context-live.R       ✓ Complete
│
└── man/ (generated by roxygen2)

## Modular Structure

The package follows a modular organization with clear separation of concerns:

### API Layer (`api-core.R`)
- Low-level API communication
- Thread and message management
- HTTP request handling with retry logic

### Chat Interface (10 files)
- `chat-core.R` - Main chat functions
- `chat-ui.R` - Shiny UI structure
- `chat-ui-components.R` - Reusable UI components
- `chat-conversation.R` - S7 ConversationManager class
- `chat-persistence.R` - Save/load functionality
- `chat-context-gather.R` - Context gathering logic
- `chat-helpers.R` - File/code writing utilities
- `chat-utils.R` - File tree rendering, data frame detection
- `chat-css.R` - Styling
- `chat-js.R` - Client-side JavaScript

### Chat Handlers (5 files, split for maintainability)
- `chat-handlers-message.R` - Send message logic
- `chat-handlers-conversation.R` - New/switch/delete conversations
- `chat-handlers-context-apply.R` - Apply context when sending messages
- `chat-handlers-context-data.R` - Data frame selection handlers
- `chat-handlers-context-files.R` - File selection/refresh handlers

### Context System (9 files)
- `context-project.R` - Project-level context
- `context-data.R` - Data frame descriptions
- `context-env.R` - Environment information
- `context-file.R` - File descriptions with tiered levels
- `context-file-parse.R` - Parse R files for function info
- `context-combine.R` - Combine multiple context sources
- `context-config.R` - Read CASSIDY.md configuration files
- `context-git.R` - Git repository status
- `context-tools.R` - Internal helper functions

### Skills System (3 files)
- `skills-discovery.R` - Discover and load skill files
- `skills-context.R` - Context integration for skills
- `skills-functions.R` - User-facing skill management

### Utilities
- `cassidy-classes.R` - S3 print methods
- `cassidyr-package.R` - Package documentation and imports
- `scripts.R` - Script conversion utilities
- `utils.R` - General utilities (%||% operator)
- `xyz.R` - Development helpers (import scanning)
